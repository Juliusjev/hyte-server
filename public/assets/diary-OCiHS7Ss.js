import{f as m}from"./fetch-ZdQQvvGr.js";v();document.addEventListener("DOMContentLoaded",function(){y()});async function y(){console.log("Haetaan kaikki käyttäjän merkinnät tietokannasta");const d=`https://healthdiary.northeurope.cloudapp.azure.com/api/entries/${localStorage.getItem("user_id")}`,a={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};m(d,a).then(r=>{B(r)})}function B(e){const d=document.querySelector(".tbody");d.innerHTML="";const n=document.getElementById("editEntryModal");e.reverse().forEach(t=>{const o=document.createElement("tr"),c=new Date(t.entry_date).toLocaleDateString("fi-Fi"),l=document.createElement("td");l.innerText=c;const i=document.createElement("td");i.innerText=t.mood;const p=document.createElement("td");p.innerText=t.weight;const g=document.createElement("td");g.innerText=t.sleep_hours;const h=document.createElement("td");h.innerText=t.notes;const E=document.createElement("td"),s=document.createElement("button");s.className="del",s.setAttribute("data-id",t.entry_id),s.innerText="Poista merkintä",s.addEventListener("click",S),E.appendChild(s);const I=document.createElement("td"),u=document.createElement("button");u.className="mod",u.setAttribute("data-id",t.entry_id),u.innerText="Muokkaa",u.addEventListener("click",()=>k(t)),I.appendChild(u),o.appendChild(l),o.appendChild(i),o.appendChild(p),o.appendChild(g),o.appendChild(h),o.appendChild(I),o.appendChild(E),d.appendChild(o)}),document.querySelector(".close").addEventListener("click",()=>{n.style.display="none"}),window.onclick=function(t){t.target==n&&(n.style.display="none")}}function k(e){document.getElementById("editDate").value=new Date(e.entry_date).toISOString().split("T")[0],document.getElementById("editMood").value=e.mood,document.getElementById("editWeight").value=e.weight,document.getElementById("editSleep").value=e.sleep_hours,document.getElementById("editEntry").value=e.notes,document.getElementById("entryId").value=e.entry_id,document.getElementById("editEntryForm").addEventListener("submit",w);const n=document.getElementById("editEntryModal");n.style.display="block"}document.getElementById("entryForm").addEventListener("submit",f);function f(e){e.preventDefault(),console.log(e);const d="https://healthdiary.northeurope.cloudapp.azure.com/api/entries/";let n=localStorage.getItem("token");const a=document.getElementById("setDate").value,r=document.getElementById("setMood").value,t=document.getElementById("setWeight").value,o=document.getElementById("setSleep").value,c=document.getElementById("setEntry").value,l={method:"POST",headers:{Authorization:"Bearer "+n,"Content-type":"application/json"},body:JSON.stringify({entry_date:a,mood:r,weight:t,sleep_hours:o,notes:c})};m(d,l).then(i=>{console.log(i),alert("Merkinnän lisäys onnistunut!"),document.getElementById("setDate").value="",document.getElementById("setMood").value="",document.getElementById("setWeight").value="",document.getElementById("setSleep").value="",document.getElementById("setEntry").value="",y()})}function w(e){e.preventDefault(),console.log("Päivitetään merkintä"),console.log(e);const d=document.getElementById("entryId").value,n=`https://healthdiary.northeurope.cloudapp.azure.com/api/entries/${d}`;let a=localStorage.getItem("token");const r=document.getElementById("editDate").value,t=document.getElementById("editMood").value,o=document.getElementById("editWeight").value,c=document.getElementById("editSleep").value,l=document.getElementById("editEntry").value,i={method:"PUT",headers:{Authorization:"Bearer: "+a,"Content-type":"application/json"},body:JSON.stringify({id:d,entry_date:r,mood:t,weight:o,sleep_hours:c,notes:l})};m(n,i).then(p=>{console.log(p),alert("Merkinnän päivitys onnistunut!");const g=document.getElementById("editEntryModal");g.style.display="none",y()})}function S(e){console.log(e);const n=`https://healthdiary.northeurope.cloudapp.azure.com/api/entries/${e.target.attributes["data-id"].value}`,r={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Haluatko varmasti poistaa merkinnän?")&&(console.log("Poisto onnistunut"),m(n,r).then(o=>{console.log(o),y()}))}function v(){console.log("Hei, täällä ollaan!");const e="https://healthdiary.northeurope.cloudapp.azure.com/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};m(e,n).then(a=>{document.getElementById("name").innerHTML=a.user.username})}document.getElementById("logout").addEventListener("click",function(){confirm("Haluatko varmasti kirjautua ulos?")&&(alert("Kirjauduttu ulos onnistuneesti! "),localStorage.removeItem("token"),localStorage.removeItem("username"),window.location.href="index.html")});v();document.addEventListener("DOMContentLoaded",function(){y()});
