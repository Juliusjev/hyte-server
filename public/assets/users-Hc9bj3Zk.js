import{f as s}from"./fetch-twLTWqyN.js";T();const E=document.querySelector(".get_users");E.addEventListener("click",p);let m=[];async function p(){console.log("Haetaan kaikki kÃ¤yttÃ¤jÃ¤t tietokannasta");const n="https://healthdiary.northeurope.cloudapp.azure.com/api/users",t={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};s(n,t).then(e=>{m=e,g(e)})}function g(n){console.log(n);const o=document.querySelector(".tbody");o.innerHTML="",n.forEach(t=>{const e=document.createElement("tr");e.appendChild(l(t.username)),e.appendChild(l(t.email)),e.appendChild(l(t.user_level)),t.user_id.toString()===localStorage.getItem("user_id")?(e.appendChild(y(t.user_id,"Muokkaa")),e.appendChild(k(t.user_id,"Poista"))):(e.appendChild(l("")),e.appendChild(l(""))),e.appendChild(l(t.user_id)),o.appendChild(e)})}function l(n){const o=document.createElement("td");return o.innerText=n,o}function y(n,o,t){const e=document.createElement("button");e.className="mod",e.setAttribute("data-id",n),e.innerText=o,e.addEventListener("click",f);const a=document.createElement("td");return a.appendChild(e),a}function k(n,o,t){const e=document.createElement("button");e.className="del",e.setAttribute("data-id",n),e.innerText=o,e.addEventListener("click",C);const a=document.createElement("td");return a.appendChild(e),a}function f(n){n.preventDefault();const o=n.target.getAttribute("data-id"),t=m.find(e=>e.user_id.toString()===o);t?(document.getElementById("newUsername").value=t.username||"",document.getElementById("newPassword").value="",document.getElementById("newEmail").value=t.email||"",document.getElementById("editUserForm").style.display="block"):console.error("KÃ¤yttÃ¤jÃ¤Ã¤ ei lÃ¶ydy.")}document.querySelector("#editUser");document.querySelector("#editUserForm").addEventListener("submit",w);function w(n){n.preventDefault(),console.log("PÃ¤ivitetÃ¤Ã¤n kÃ¤yttÃ¤jÃ¤tietoja");const o=document.getElementById("newUsername").value,t=document.getElementById("newPassword").value,e=document.getElementById("newEmail").value,a=localStorage.getItem("token"),i="https://healthdiary.northeurope.cloudapp.azure.com/api/users",r={method:"PUT",headers:{Authorization:"Bearer "+a,"Content-type":"application/json"},body:JSON.stringify({username:o,password:t,email:e})};s(i,r).then(c=>{console.log(c),alert("KÃ¤yttÃ¤jÃ¤tietojen pÃ¤ivitys onnistui"),document.getElementById("newUsername").value="",document.getElementById("newPassword").value="",document.getElementById("newEmail").value="",p()})}function C(n){console.log(n);const o=n.target.attributes["data-id"].value,t=`https://healthdiary.northeurope.cloudapp.azure.com/api/users/${o}`,a={method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}};confirm(`Haluatko varmasti poistaa kÃ¤yttÃ¤jÃ¤n ID: ${o}? 
  HUOM! Sinut kirjataan ulos!`)&&s(t,a).then(r=>{if(Object.keys(r).length===0)throw new Error("401 Unauthorized");alert("KÃ¤yttÃ¤jÃ¤ poistettu onnistuneesti"),h()}).catch(r=>{alert(`Virhe kÃ¤yttÃ¤jÃ¤n poistossae: ${r.message}`)})}function T(){s("https://healthdiary.northeurope.cloudapp.azure.com/api/entries/top",{method:"GET"}).then(t=>{v(t)})}function v(n){console.log(n);const o=document.querySelector(".topbody");o.innerHTML="",n.forEach((t,e)=>{const a=document.createElement("tr"),i=document.createElement("td");i.innerText=t.username;const r=document.createElement("td");r.innerText=t.DiaryEntriesCount;const c=document.createElement("td");c.innerText=t.ExercisesCount;const u=document.createElement("td");u.innerText=t.TotalEntries;const d=document.createElement("td");e===0?d.innerText="ðŸ¥‡":e===1?d.innerText="ðŸ¥ˆ":e===2?d.innerText="ðŸ¥‰":d.innerText="",a.appendChild(i),a.appendChild(r),a.appendChild(c),a.appendChild(u),a.appendChild(d),o.appendChild(a)})}function I(){console.log("Hei, tÃ¤Ã¤llÃ¤ ollaan!");const n="https://healthdiary.northeurope.cloudapp.azure.com/api/auth/me",t={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};s(n,t).then(e=>{console.log(e),document.getElementById("name").innerHTML=e.user.username})}I();document.getElementById("logout").addEventListener("click",h);function h(){confirm("Haluatko varmasti kirjautua ulos?")&&(alert("Kirjauduttu ulos onnistuneesti! "),localStorage.removeItem("token"),localStorage.removeItem("username"),window.location.href="index.html")}
