import{f as g}from"./fetch--FzvIhyn.js";h();document.addEventListener("DOMContentLoaded",function(){r()});const k=document.querySelector(".get_entry");k.addEventListener("click",r);async function r(){console.log("Haetaan kaikki käyttäjän merkinnät tietokannasta");const o=`http://127.0.0.1:3000/api/entries/${localStorage.getItem("user_id")}`,n={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};g(o,n).then(d=>{I(d)})}function I(t){console.log(t);const o=document.querySelector(".tbody");o.innerHTML="",t.forEach(e=>{console.log(e.entry_date,e.user_id,e.user_level);const n=document.createElement("tr"),d=new Date(e.entry_date).toLocaleDateString("fi-Fi"),c=document.createElement("td");c.innerText=d;const i=document.createElement("td");i.innerText=e.mood;const s=document.createElement("td");s.innerText=e.weight;const u=document.createElement("td");u.innerText=e.sleep_hours;const m=document.createElement("td");m.innerText=e.notes;const y=document.createElement("td"),a=document.createElement("button");a.className="del",a.setAttribute("data-id",e.entry_id),a.innerText="Poista merkintä",a.addEventListener("click",_),y.appendChild(a);const E=document.createElement("td"),l=document.createElement("button");l.className="mod",l.setAttribute("data-id",e.entry_id),l.innerText="Muokkaa",l.addEventListener("click",()=>v(e)),E.appendChild(l),n.appendChild(c),n.appendChild(i),n.appendChild(s),n.appendChild(u),n.appendChild(m),n.appendChild(E),n.appendChild(y),o.appendChild(n)})}const p=document.getElementById("editEntryModal"),f=document.querySelector(".close");function v(t){document.getElementById("editDate").value=new Date(t.entry_date).toISOString().split("T")[0],document.getElementById("editMood").value=t.mood,document.getElementById("editWeight").value=t.weight,document.getElementById("editSleep").value=t.sleep_hours,document.getElementById("editEntry").value=t.notes,document.getElementById("entryId").value=t.entry_id,document.getElementById("editEntryForm").addEventListener("submit",B);const e=document.getElementById("editEntryModal");e.style.display="block"}f.onclick=function(){p.style.display="none"};window.onclick=function(t){t.target==p&&(p.style.display="none")};function B(t){t.preventDefault(),console.log("Päivitetään merkintä"),console.log(t);const o=document.getElementById("entryId").value,e=`http://127.0.0.1:3000/api/entries/${o}`;let n=localStorage.getItem("token");const d=document.getElementById("editDate").value,c=document.getElementById("editMood").value,i=document.getElementById("editWeight").value,s=document.getElementById("editSleep").value,u=document.getElementById("editEntry").value,m={method:"PUT",headers:{Authorization:"Bearer: "+n,"Content-type":"application/json"},body:JSON.stringify({id:o,entry_date:d,mood:c,weight:i,sleep_hours:s,notes:u})};g(e,m).then(y=>{console.log(y),alert("Merkinnän päivitys onnistunut!");const a=document.getElementById("editEntryModal");a.style.display="none",r()})}function _(t){console.log(t);const e=`http://127.0.0.1:3000/api/entries/${t.target.attributes["data-id"].value}`,d={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Haluatko varmasti poistaa merkinnän?")&&g(e,d).then(i=>{console.log(i),r()})}function h(){console.log("Hei, täällä ollaan!");const t="http://localhost:3000/api/auth/me",e={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};g(t,e).then(n=>{console.log(n),document.getElementById("name").innerHTML=n.user.username})}document.getElementById("logout").addEventListener("click",function(){alert("Kirjauduttu ulos"),localStorage.removeItem("token"),localStorage.removeItem("username"),window.location.href="index.html"});h();document.addEventListener("DOMContentLoaded",function(){r()});
