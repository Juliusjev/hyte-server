import{f as u}from"./fetch-twLTWqyN.js";const a=document.getElementById("loginModal"),t=document.getElementById("createUserModal"),d=document.getElementById("login"),y=document.getElementById("create_user"),m=a.querySelector(".close"),p=t.querySelector(".close");d.addEventListener("click",()=>{a.style.display="block"});y.addEventListener("click",()=>{t.style.display="block"});m.addEventListener("click",()=>{a.style.display="none"});p.addEventListener("click",()=>{t.style.display="none"});window.addEventListener("click",o=>{o.target===a&&(a.style.display="none")});window.addEventListener("click",o=>{o.target===t&&(t.style.display="none")});const g=t.querySelector(".createuser"),n=t.querySelector("#create_user_form");g.addEventListener("click",async o=>{o.preventDefault();const l="https://healthdiary.northeurope.cloudapp.azure.com/api/users",s=n.querySelector("input[name=password]").value,c=n.querySelector("input[name=confirmPassword]").value;if(s!==c){alert("Salasanat eivät täsmää. Yritä uudelleen.");return}const i={username:n.querySelector("input[name=username]").value,password:n.querySelector("input[name=password]").value,email:n.querySelector("input[name=email]").value},r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};try{const e=await u(l,r);console.log(e),alert("Uusi käyttäjä luotu onnistuneesti! Voit nyt kirjautua sisään."),t.style.display="none"}catch(e){console.error(e),alert("Virhe käyttäjää luodessa. Tarkista tiedot ja yritä uudelleen.")}});const h=document.querySelector(".loginuser");h.addEventListener("click",async o=>{o.preventDefault(),console.log("Nyt logataan sisään");const l="https://healthdiary.northeurope.cloudapp.azure.com/api/auth/login",s=document.querySelector("#login_form"),c={username:s.querySelector("input[name=username]").value,password:s.querySelector("input[name=password]").value},i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)};try{const r=await fetch(l,i),e=await r.json();if(!r.ok)throw new Error(e.message||"Unauthorized user: käyttäjänimi tai salasana ei täsmää");console.log(e),localStorage.setItem("token",e.token),localStorage.setItem("username",e.user.username),localStorage.setItem("user_id",e.user.user_id),alert("Olet nyt kirjautunut"),window.location.href="home.html"}catch(r){console.error("Login error:",r),alert(r.message)}});
