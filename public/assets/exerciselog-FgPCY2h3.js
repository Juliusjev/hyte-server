import{f as y}from"./fetch-twLTWqyN.js";S();document.addEventListener("DOMContentLoaded",function(){g()});async function g(){console.log("Haetaan kaikki käyttäjän harjoitukset tietokannasta");const i=`https://healthdiary.northeurope.cloudapp.azure.com/api/exercises/${localStorage.getItem("user_id")}`,d={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};y(i,d).then(a=>{console.log("Tässä data:",a),k(a)})}function k(e){const i=document.querySelector(".tbody");i.innerHTML="";const n=document.getElementById("editExerciseModal");e.reverse().forEach(t=>{const o=document.createElement("tr"),s=new Date(t.date).toLocaleDateString("fi-Fi"),r=document.createElement("td");r.innerText=s;const c=document.createElement("td");c.innerText=t.type;const l=document.createElement("td");t.intensity==="High"?l.innerText="Kova":t.intensity==="Medium"?l.innerText="Keskiverto":t.intensity==="Low"&&(l.innerText="Matala");const u=document.createElement("td"),h=Math.floor(t.duration/60),E=t.duration%60;h>0?u.innerText=`${h} t ${E} min`:u.innerText=`${E} min`;const v=document.createElement("td"),m=document.createElement("button");m.className="del",m.setAttribute("data-id",t.exercise_id),m.innerText="Poista merkintä",m.addEventListener("click",x),v.appendChild(m);const I=document.createElement("td"),p=document.createElement("button");p.className="mod",p.setAttribute("data-id",t.exercise_id),p.innerText="Muokkaa",p.addEventListener("click",()=>B(t)),I.appendChild(p),o.appendChild(r),o.appendChild(c),o.appendChild(l),o.appendChild(u),o.appendChild(I),o.appendChild(v),i.appendChild(o)}),document.querySelector(".close").addEventListener("click",()=>{n.style.display="none"}),window.onclick=function(t){t.target==n&&(n.style.display="none")}}function B(e){document.getElementById("editDate").value=new Date(e.date).toISOString().split("T")[0],document.getElementById("editActivity").value=e.type,document.getElementById("editIntensity").value=e.intensity;const i=Math.floor(e.duration/60).toString().padStart(2,"0"),n=(e.duration%60).toString().padStart(2,"0");document.getElementById("editDuration").value=`${i}:${n}`,document.getElementById("exerciseId").value=e.exercise_id,document.getElementById("editExerciseForm").addEventListener("submit",D);const a=document.getElementById("editExerciseModal");a.style.display="block"}document.getElementById("exerciseForm").addEventListener("submit",f);function f(e){e.preventDefault(),console.log(e);const i="https://healthdiary.northeurope.cloudapp.azure.com/api/exercises/";let n=localStorage.getItem("token");const d=document.getElementById("setDuration").value,[a,t]=d.split(":").map(Number),o=a*60+t,s={type:document.getElementById("setActivity").value,duration:o,intensity:document.getElementById("setIntensity").value,date:document.getElementById("setDate").value};console.log(s);const r={method:"POST",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"},body:JSON.stringify(s)};y(i,r).then(c=>{console.log(c),alert("Harjoitus lisätty onnistuneesti!"),document.getElementById("setActivity").value="",document.getElementById("setIntensity").value="",document.getElementById("setDuration").value="",document.getElementById("setDate").value="",g()})}function x(e){const n=`https://healthdiary.northeurope.cloudapp.azure.com/api/exercises/${e.target.attributes["data-id"].value}`,a={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Haluatko varmasti poistaa harjoituksen?")&&(console.log("Poisto onnistunut"),y(n,a).then(o=>{console.log(o),g()}))}function D(e){e.preventDefault(),console.log("Päivitetään harjoitus");const i=localStorage.getItem("username"),d=`https://healthdiary.northeurope.cloudapp.azure.com/api/exercises/${document.getElementById("exerciseId").value}`;let a=localStorage.getItem("token");const t=document.getElementById("editDuration").value,[o,s]=t.split(":").map(Number),r=o*60+s,c={user_id:i,type:document.getElementById("editActivity").value,duration:r,intensity:document.getElementById("editIntensity").value,date:document.getElementById("editDate").value},l={method:"PUT",headers:{Authorization:"Bearer: "+a,"Content-Type":"application/json"},body:JSON.stringify(c)};y(d,l).then(u=>{console.log(u),alert("Harjoituksen päivitys onnistui!");const h=document.getElementById("editExerciseModal");h.style.display="none",g()})}function S(){console.log("Hei, täällä ollaan!");const e="https://healthdiary.northeurope.cloudapp.azure.com/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};y(e,n).then(d=>{document.getElementById("name").innerHTML=d.user.username})}document.getElementById("logout").addEventListener("click",function(){confirm("Haluatko varmasti kirjautua ulos?")&&(alert("Kirjauduttu ulos onnistuneesti! "),localStorage.removeItem("token"),localStorage.removeItem("username"),window.location.href="index.html")});
