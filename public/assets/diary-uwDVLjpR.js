import{f as m}from"./fetch-twLTWqyN.js";async function g(){console.log("Haetaan kaikki käyttäjän merkinnät tietokannasta");const d=`https://healthdiary.northeurope.cloudapp.azure.com/api/entries/${localStorage.getItem("user_id")}`,a={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};m(d,a).then(l=>{v(l)})}function v(e){const d=document.querySelector(".tbody");d.innerHTML="";const n=document.getElementById("editEntryModal");e.reverse().forEach(t=>{const o=document.createElement("tr"),c=new Date(t.entry_date).toLocaleDateString("fi-Fi"),r=document.createElement("td");r.innerText=c;const i=document.createElement("td");i.innerText=t.mood;const y=document.createElement("td");y.innerText=t.weight;const p=document.createElement("td");p.innerText=t.sleep_hours;const h=document.createElement("td");h.innerText=t.notes;const E=document.createElement("td"),s=document.createElement("button");s.className="del",s.setAttribute("data-id",t.entry_id),s.innerText="Poista merkintä",s.addEventListener("click",w),E.appendChild(s);const I=document.createElement("td"),u=document.createElement("button");u.className="mod",u.setAttribute("data-id",t.entry_id),u.innerText="Muokkaa",u.addEventListener("click",()=>B(t)),I.appendChild(u),o.appendChild(r),o.appendChild(i),o.appendChild(y),o.appendChild(p),o.appendChild(h),o.appendChild(I),o.appendChild(E),d.appendChild(o)}),document.querySelector(".close").addEventListener("click",()=>{n.style.display="none"}),window.onclick=function(t){t.target==n&&(n.style.display="none")}}function B(e){document.getElementById("editDate").value=new Date(e.entry_date).toISOString().split("T")[0],document.getElementById("editMood").value=e.mood,document.getElementById("editWeight").value=e.weight,document.getElementById("editSleep").value=e.sleep_hours,document.getElementById("editEntry").value=e.notes,document.getElementById("entryId").value=e.entry_id,document.getElementById("editEntryForm").addEventListener("submit",f);const n=document.getElementById("editEntryModal");n.style.display="block"}document.getElementById("entryForm").addEventListener("submit",k);function k(e){e.preventDefault(),console.log(e);const d="https://healthdiary.northeurope.cloudapp.azure.com/api/entries/";let n=localStorage.getItem("token");const a=document.getElementById("setDate").value,l=document.getElementById("setMood").value,t=document.getElementById("setWeight").value,o=document.getElementById("setSleep").value,c=document.getElementById("setEntry").value,r={method:"POST",headers:{Authorization:"Bearer "+n,"Content-type":"application/json"},body:JSON.stringify({entry_date:a,mood:l,weight:t,sleep_hours:o,notes:c})};m(d,r).then(i=>{console.log(i),alert("Merkinnän lisäys onnistunut!"),document.getElementById("setDate").value="",document.getElementById("setMood").value="",document.getElementById("setWeight").value="",document.getElementById("setSleep").value="",document.getElementById("setEntry").value="",g()})}function f(e){e.preventDefault(),console.log("Päivitetään merkintä"),console.log(e);const d=document.getElementById("entryId").value,n=`https://healthdiary.northeurope.cloudapp.azure.com/api/entries/${d}`;let a=localStorage.getItem("token");const l=document.getElementById("editDate").value,t=document.getElementById("editMood").value,o=parseFloat(document.getElementById("editWeight").value).toFixed(2),c=document.getElementById("editSleep").value,r=document.getElementById("editEntry").value,i={method:"PUT",headers:{Authorization:"Bearer: "+a,"Content-type":"application/json"},body:JSON.stringify({id:d,entry_date:l,mood:t,weight:o,sleep_hours:c,notes:r})};m(n,i).then(y=>{console.log(y),alert("Merkinnän päivitys onnistunut!");const p=document.getElementById("editEntryModal");p.style.display="none",g()})}function w(e){console.log(e);const n=`https://healthdiary.northeurope.cloudapp.azure.com/api/entries/${e.target.attributes["data-id"].value}`,l={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Haluatko varmasti poistaa merkinnän?")&&(console.log("Poisto onnistunut"),m(n,l).then(o=>{console.log(o),g()}))}function S(){console.log("Hei, täällä ollaan!");const e="https://healthdiary.northeurope.cloudapp.azure.com/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};m(e,n).then(a=>{document.getElementById("name").innerHTML=a.user.username})}document.getElementById("logout").addEventListener("click",function(){confirm("Haluatko varmasti kirjautua ulos?")&&(alert("Kirjauduttu ulos onnistuneesti! "),localStorage.removeItem("token"),localStorage.removeItem("username"),window.location.href="index.html")});S();document.addEventListener("DOMContentLoaded",function(){g()});
