import{f as m}from"./fetch-twLTWqyN.js";async function E(){console.log("Haetaan kaikki käyttäjän merkinnät tietokannasta");const d=`http://127.0.0.1:3000/api/entries/${localStorage.getItem("user_id")}`,a={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};m(d,a).then(l=>{v(l)})}function v(e){const d=document.querySelector(".tbody");d.innerHTML="";const n=document.getElementById("editEntryModal");e.reverse().forEach(t=>{const o=document.createElement("tr"),s=new Date(t.entry_date).toLocaleDateString("fi-Fi"),i=document.createElement("td");i.innerText=s;const r=document.createElement("td");r.innerText=t.mood;const y=document.createElement("td");y.innerText=t.weight;const g=document.createElement("td");g.innerText=t.sleep_hours;const p=document.createElement("td");p.innerText=t.notes;const h=document.createElement("td"),c=document.createElement("button");c.className="del",c.setAttribute("data-id",t.entry_id),c.innerText="Poista merkintä",c.addEventListener("click",w),h.appendChild(c);const I=document.createElement("td"),u=document.createElement("button");u.className="mod",u.setAttribute("data-id",t.entry_id),u.innerText="Muokkaa",u.addEventListener("click",()=>B(t)),I.appendChild(u),o.appendChild(i),o.appendChild(r),o.appendChild(y),o.appendChild(g),o.appendChild(p),o.appendChild(I),o.appendChild(h),d.appendChild(o)}),document.querySelector(".close").addEventListener("click",()=>{n.style.display="none"}),window.onclick=function(t){t.target==n&&(n.style.display="none")}}function B(e){document.getElementById("editDate").value=new Date(e.entry_date).toISOString().split("T")[0],document.getElementById("editMood").value=e.mood,document.getElementById("editWeight").value=e.weight,document.getElementById("editSleep").value=e.sleep_hours,document.getElementById("editEntry").value=e.notes,document.getElementById("entryId").value=e.entry_id,document.getElementById("editEntryForm").addEventListener("submit",f);const n=document.getElementById("editEntryModal");n.style.display="block"}document.getElementById("entryForm").addEventListener("submit",k);function k(e){e.preventDefault(),console.log(e);const d="http://127.0.0.1:3000/api/entries/";let n=localStorage.getItem("token");const a=document.getElementById("setDate").value,l=document.getElementById("setMood").value,t=document.getElementById("setWeight").value,o=document.getElementById("setSleep").value,s=document.getElementById("setEntry").value,i={method:"POST",headers:{Authorization:"Bearer "+n,"Content-type":"application/json"},body:JSON.stringify({entry_date:a,mood:l,weight:t,sleep_hours:o,notes:s})};m(d,i).then(r=>{console.log(r),alert("Merkinnän lisäys onnistunut!"),document.getElementById("setDate").value="",document.getElementById("setMood").value="",document.getElementById("setWeight").value="",document.getElementById("setSleep").value="",document.getElementById("setEntry").value="",E()})}function f(e){e.preventDefault(),console.log("Päivitetään merkintä"),console.log(e);const d=document.getElementById("entryId").value,n=`http://127.0.0.1:3000/api/entries/${d}`;let a=localStorage.getItem("token");const l=document.getElementById("editDate").value,t=document.getElementById("editMood").value,o=parseFloat(document.getElementById("editWeight").value).toFixed(2),s=document.getElementById("editSleep").value,i=document.getElementById("editEntry").value,r={method:"PUT",headers:{Authorization:"Bearer: "+a,"Content-type":"application/json"},body:JSON.stringify({id:d,entry_date:l,mood:t,weight:o,sleep_hours:s,notes:i})};m(n,r).then(y=>{console.log(y),alert("Merkinnän päivitys onnistunut!");const g=document.getElementById("editEntryModal");g.style.display="none",E()})}function w(e){console.log(e);const n=`http://127.0.0.1:3000/api/entries/${e.target.attributes["data-id"].value}`,l={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Haluatko varmasti poistaa merkinnän?")&&(console.log("Poisto onnistunut"),m(n,l).then(o=>{console.log(o),E()}))}function S(){console.log("Hei, täällä ollaan!");const e="http://127.0.0.1:3000/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};m(e,n).then(a=>{document.getElementById("name").innerHTML=a.user.username})}document.getElementById("logout").addEventListener("click",function(){confirm("Haluatko varmasti kirjautua ulos?")&&(alert("Kirjauduttu ulos onnistuneesti! "),localStorage.removeItem("token"),localStorage.removeItem("username"),window.location.href="index.html")});S();document.addEventListener("DOMContentLoaded",function(){E()});
